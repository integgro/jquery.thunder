(function (a) { a.thunder = {}; a.thunder.settings = { version: "1.1.2", images: { loadingModal: "/content/jquery.thunder/images/loading_modal.gif", loadingGrid: "/content/jquery.thunder/images/loading_grid.gif", loadingForm: "/content/jquery.thunder/images/loading_form.gif" }, confirm: { label: { yes: "Yes", no: "No"} }, alert: { label: { ok: "OK"}} }; var b = { message: { create: function (b, c, d, e) { var f = { animate: true, focus: false, close: { show: true, title: "Close this notification" }, autoClose: { enable: false, delay: 5e3} }; a.extend(f, e); b.addClass("thunder-notification"); b.hide(); b.empty(); var g = a({}); var h = b.parent().css("overflow") == "visible" ? a("html:not(:animated),body:not(:animated)") : b.parent(); var i = a('<div class="thunder-notification-content"></div>'); b.addClass(c); b.append(i); if (a.isArray(d) && d.length > 0) { var j = a("<ul></ul>"); a.each(d, function () { j.append(a("<li></li>").html(this.Text)) }); i.html(j) } else { i.html(d) } if (f.focus) { g = b.prev(".thunder-notification-focus"); if (g.size() == 0) { b.before('<div class="thunder-notification-focus"></div>'); g = b.prev(".thunder-notification-focus") } } b.css("opacity", "1"); if (f.animate) { if (f.focus) { h.animate({ scrollTop: g.offset().top - 20 }, "slow", function () { b.slideDown() }) } else { b.slideDown() } } else { h.scrollTop(g.offset().top - 20); b.show() } if (f.close.show) { var k = a('<a class="close" href="#"></a>'); k.attr("title", f.close.title); b.append(k); k.click(function (a) { if (f.animate) { b.slideUp() } else { b.hide() } a.preventDefault() }); if (f.autoClose.enable) { window.setTimeout(function () { if (b.css("display") != "none") { k.trigger("click") } }, f.autoClose.delay == undefined ? 5e3 : f.autoClose.delay) } } }, success: function (c, d) { return this.each(function () { b.message.create(a(this), "thunder-success", c, d) }) }, error: function (c, d) { return this.each(function () { b.message.create(a(this), "thunder-error", c, d) }) }, attention: function (c, d) { return this.each(function () { b.message.create(a(this), "thunder-attention", c, d) }) }, information: function (c, d) { return this.each(function () { b.message.create(a(this), "thunder-information", c, d) }) } } }; a.fn.message = function (c) { if (b.message[c]) { return b.message[c].apply(this, Array.prototype.slice.call(arguments, 1)) } else if (typeof c == "object" || typeof c == "string") { return b.message.success.apply(this, arguments) } else { a.error("Method " + c + " does not exist on jQuery.message") } }; a.fn.ajaxForm = function (b) { var c = a(this); var d = a.extend({ message: null, loading: null, focus: true, disableElements: "input,select,textarea,button", cssFieldError: "thunder-form-field-error", onSuccess: function () { }, onBefore: function () { }, onComplete: function () { }, onBeforeSubmit: function () { } }, b); var e = a(d.message); var f = a(d.loading); var g = c.find('input[type="submit"]'); var h = c.parent().css("overflow") == "visible" ? a("html:not(:animated),body:not(:animated)") : c.parent(); if (e.size() == 0 && c.prev(".thunder-form-message").size() == 0) { c.before('<div class="thunder-form-message"></div>'); e = c.prev(".thunder-form-message") } if (f.size() == 0) { g.after('<span class="thunder-form-loading"></span>'); f = c.find(".thunder-form-loading"); f.css({ "margin-top": -g.outerHeight(), "margin-left": g.outerWidth() + 2 }) } c.data("message", e); e.hide(); f.hide(); if (!c.attr("action") || c.attr("action").trim() == "") { e.message("error", "Form action no exist.") } c.live("submit", function () { e.hide(); d.onBeforeSubmit(); a.ajax({ statusCode: statusCode(e, { focus: true }), url: c.attr("action"), type: c.attr("method"), headers: { "Thunder-Ajax": true }, data: c.serialize(), beforeSend: function () { a(d.disableElements, c).disableElement(); a("input,select,textarea", c).removeClass(d.cssFieldError); f.show(); d.onBefore() }, complete: function () { a(d.disableElements, c).enableElement(); f.hide(); d.onComplete() }, success: function (b) { window.setTimeout(function () { if (typeof b == "object") { if (b.Status) { if (b.Status == 200) { d.onSuccess(c, b) } else { if (b.Messages) { if (b.Status == 202) { e.message("error", b.Messages, { focus: true }) } else if (b.Status == 203) { e.message("information", b.Messages, { focus: true }) } else if (b.Status == 204) { e.message("attention", b.Messages, { focus: true }) } a.each(b.Messages, function () { a('input[name="' + this.Field + '"],select[name="' + this.Field + '"],textarea[name="' + this.Field + '"]').addClass(d.cssFieldError) }) } else { e.message("error", "Message no exist in request result.", { focus: true }) } } } } else { if (a(b).is(".message")) { e.html(b); if (d.focus) { h.animate({ scrollTop: e.offset().top - 20 }, "slow", function () { e.slideDown() }) } else { e.slideDown() } } else { d.onSuccess(c, b) } } }, 0) } }); return false }) }; a.fn.grid = function (b) { var c = a(this); var d = a.extend({ message: null, loading: null, form: null, url: c.data("url"), pageSize: !c.data("page-size") ? 10 : c.data("page-size"), load: !c.data("load") ? true : c.data("load"), orders: [], onComplete: function () { }, onBeforeSubmit: function () { } }, b); var e = a(d.message); var f = a(d.loading); var g = a(d.form); var h = a('<div class="thunder-grid-content"></div>'); c.html(h); if (e.size() == 0 && c.prev(".thunder-grid-message").size() == 0) { c.before('<div class="thunder-grid-message"></div>'); e = c.prev(".thunder-grid-message") } if (g.size() == 0) { c.prepend('<form class="thunder-grid-form"></form>'); g = a(".thunder-grid-form", c) } g.append('<input type="hidden" name="CurrentPage" value="0" />'); g.append('<input type="hidden" name="PageSize" value="' + d.pageSize + '" />'); g.setOrders(d.orders); if (!d.url || d.url == "") { e.message("error", "Url is null."); return } var i = function () { if (a(d.loading).size() == 0) { h.html('<div class="thunder-grid-loading"><img src="' + a.thunder.settings.images.loadingGrid + '" /></div>'); f = a(".thunder-grid-loading", h) } f.hide() }; var j = function (b) { d.onBeforeSubmit(); a.ajax({ statusCode: statusCode(e), type: "POST", data: g.serialize(), url: d.url, headers: { "Thunder-Ajax": true }, beforeSend: function () { b.show() }, complete: function () { b.hide() }, success: function (b) { if (typeof b == "string") { h.html(b); a("tbody tr:even", c).addClass("even"); d.onComplete(c) } } }) }; var k = function (b) { a('input:hidden[name="CurrentPage"]', g).val(b); j(a(".thunder-paged-loading", c)) }; if (d.load) { i(); j(f) } g.submit(function () { a('input:hidden[name="CurrentPage"]', g).val(0); i(); j(f); return false }); a("a.thunder-grid-paged", c).live("click", function (b) { var c = a(this); if (!c.is(".disabled")) { k(c.data("page")) } b.preventDefault() }); a("a.thunder-grid-order", c).live("click", function (b) { var c = a(this); if (c.data("column") != "undefined" && c.data("asc") != "undefined") { g.setOrders([{ Column: c.data("column"), Asc: c.data("asc")}]); a('input:hidden[name="CurrentPage"]', g).val(0); j(f) } b.preventDefault() }); a("select.thunder-grid-paged", c).live("change", function () { var b = a(this); k(a("option:selected", b).val()) }) }; a.fn.modal = function (b) { var c = a.extend({ iframe: false, iframeScroll: "no", url: "", width: 600, centerLoading: true, cssClass: "", noCache: true, onOpen: function () { }, onClose: function () { } }, b); return this.each(function () { var b = a(this); b.live("click", function (d) { a.extend(c, { iframe: b.data("iframe") != undefined ? b.data("iframe") : c.iframe, iframeScroll: b.data("iframe-scroll") != undefined ? b.data("iframe-scroll") : c.iframeScroll, url: b.is("a") ? b.attr("href") : c.url, width: b.data("width") != undefined ? b.data("width") : c.width, height: b.data("height") != undefined ? b.data("height") : c.height, centerLoading: b.data("center-loading") != undefined ? b.data("center-loading") : c.centerLoading, cssClass: b.data("css-class") != undefined ? b.data("css-class") : c.cssClass, noCache: b.data("no-cache") != undefined ? b.data("no-cache") : c.noCache }); a.modal(c); d.preventDefault() }) }) }; a.modal = function (b) { var c = a.extend({ iframe: false, iframeScroll: "no", url: "", width: 600, centerLoading: true, cssClass: "", noCache: true, onOpen: function () { }, onClose: function () { } }, b); var d = '<div class="thunder-modal-loading"><img src="' + a.thunder.settings.images.loadingModal + '" /></div>'; if (a("body")["dialog"] == undefined) { a.error("This project not implement jquery.ui."); return } if (a(".thunder-modal").size() == 0) { a("body").prepend('<div class="thunder-modal"></div>') } var e = a(".thunder-modal", a("body")).addClass(c.cssClass); e.dialog(a.extend(c, { autoOpen: true, modal: true, resizable: false, draggable: false, open: function () { a(".ui-dialog-titlebar ").remove(); e.empty(); e.append(d); d = a(".thunder-modal-loading", e); if (c.centerLoading) { a("img", d).load(function () { d.css({ position: "absolute", top: "50%", left: "50%" }); if (a.browser.msie) { var b = this; d.show(); window.setTimeout(function () { d.css({ "margin-left": "-" + b.width / 2 + "px", "margin-top": "-" + b.height / 2 + "px" }) }, 10) } else { d.css({ "margin-left": "-" + this.width / 2 + "px", "margin-top": "-" + this.height / 2 + "px" }).show() } }) } else { d.show() } if (c.iframe) { var b = a('<iframe frameborder="0" marginheight="0" marginwidth="0" scrolling="auto"></iframe>').hide(); if (c.noCache) { if (c.url.lastIndexOf("?") != -1) { c.url += "&" } else { c.url += "?" } c.url += "nocache=" + parseInt(Math.random() * 9999999999) } b.attr("scrolling", c.iframeScroll); b.attr("width", e.width()); b.attr("height", e.height()); e.css("overflow", "hidden"); e.append(b); b.attr("src", c.url); b.load(function () { b.show(); d.remove(); var f = b.contents().find(".thunder-modal-close"); f.click(function (a) { a.preventDefault(); e.dialog("close") }); if (c.closeOnEscape == undefined || c.closeOnEscape) { b.contents().on("keydown", function (b) { if (b.keyCode === a.ui.keyCode.ESCAPE) { e.dialog("close") } b.stopPropagation() }) } c.onOpen(b.contents()) }) } else { e.append('<div class="thunder-modal-message"></div>'); a.ajax({ statusCode: statusCode(a(".thunder-modal-message", e), { close: { show: false} }), headers: { "Thunder-Ajax": true, "Thunder-Modal": true }, url: c.url, success: function (b) { e.html(b); a(".thunder-modal-close", e).click(function (a) { a.preventDefault(); e.dialog("close") }); c.onOpen(e) } }) } }, beforeClose: function () { c.onClose(e); e.empty(); e.dialog("destroy") } })) }; a.closeModal = function () { if (a(".thunder-modal").size() > 0) { a(".thunder-modal").dialog("close") } }; a.confirm = function (b, c) { var d = a.extend(a.thunder.settings.confirm, { width: 480, height: "auto", cssClass: "", onYes: function () { }, onNo: function () { } }, c); if (a("body")["dialog"] == undefined) { a.error("This project not implement jquery.ui."); return } if (a(".thunder-confirm").size() == 0) { a("body").prepend('<div class="thunder-confirm"></div>') } var e = a('<a href="#" class="thunder-confirm-yes"></a>').html(d.label.yes); var f = a('<a href="#" class="thunder-confirm-no"></a>').html(d.label.no); var g = a('<div class="thunder-confirm-message"></div>').html(b); var h = a('<div class="thunder-confirm-action"></div>').append(e).append(f); var i = a(".thunder-confirm", a("body")).addClass(d.cssClass).append(g).append(h); e.click(function (a) { d.onYes(); i.dialog("close"); a.preventDefault() }); f.click(function (a) { d.onNo(); i.dialog("close"); a.preventDefault() }); i.dialog({ autoOpen: true, modal: true, resizable: false, closeOnEscape: false, draggable: false, width: d.width, height: d.height, open: function () { a(".ui-dialog-titlebar ").remove() }, close: function () { i.remove(); i.dialog("destroy") } }) }; a.alert = function (b, c) { var d = a.extend(a.thunder.settings.alert, { width: 480, height: "auto", cssClass: "", onOk: function () { } }, c); if (a("body")["dialog"] == undefined) { a.error("This project not implement jquery.ui."); return } if (a(".thunder-alert").size() == 0) { a("body").prepend('<div class="thunder-alert"></div>') } var e = a('<a href="#" class="thunder-alert-ok"></a>').html(d.label.ok); var f = a('<div class="thunder-alert-message"></div>').html(b); var g = a('<div class="thunder-alert-action"></div>').append(e); var h = a(".thunder-alert", a("body")).addClass(d.cssClass).append(f).append(g); e.click(function (a) { d.onOk(); h.dialog("close"); a.preventDefault() }); h.dialog({ autoOpen: true, modal: true, resizable: false, closeOnEscape: false, draggable: false, width: d.width, height: d.height, open: function () { a(".ui-dialog-titlebar ").remove() }, close: function () { h.remove(); h.dialog("destroy") } }) }; a.fn.setOrders = function (b) { return this.each(function () { var c = a(this); a("input.thunder-grid-order", c).remove(); a.each(b, function (a) { c.append('<input type="hidden" class="thunder-grid-order" name="Orders[' + a + '].Column" value="' + this.Column + '" />'); c.append('<input type="hidden" class="thunder-grid-order" name="Orders[' + a + '].Asc" value="' + this.Asc + '" />') }) }) }; a.fn.disableElement = function () { return this.each(function () { a(this).attr("disabled", "disabled") }) }; a.fn.enableElement = function () { return this.each(function () { a(this).removeAttr("disabled") }) }; a.fn.serializeObject = function () { var b = {}; var c = this.serializeArray(); a.each(c, function () { if (b[this.name]) { if (!b[this.name].push) { b[this.name] = [b[this.name]] } b[this.name].push(this.value || "") } else { b[this.name] = this.value || "" } }); return b }; statusCode = function (b, c) { var d = a.extend({}, c); return { 400: function () { b.message("error", "Bad request.", d); a(".thunder-modal-loading").hide() }, 401: function () { b.message("error", "Unauthorized.", d); a(".thunder-modal-loading").hide() }, 403: function () { b.message("error", "Forbidden.", d); a(".thunder-modal-loading").hide() }, 404: function () { b.message("error", "Page not found.", d); a(".thunder-modal-loading").hide() }, 405: function () { b.message("error", "Method not allowed.", d); a(".thunder-modal-loading").hide() }, 407: function () { b.message("error", "Proxy authentication required.", d); a(".thunder-modal-loading").hide() }, 408: function () { b.message("error", "Request timeout.", d); a(".thunder-modal-loading").hide() }, 500: function () { b.message("error", "Internal server error.", d); a(".thunder-modal-loading").hide() }, 501: function () { b.message("error", "Not implemented.", d); a(".thunder-modal-loading").hide() }, 502: function () { b.message("error", "Bad gateway.", d); a(".thunder-modal-loading").hide() }, 503: function () { b.message("error", "Service unavailable.", d); a(".thunder-modal-loading").hide() } } }; String.prototype.replaceAll = function (a, b) { var c = this; var d = c.indexOf(a); while (d > -1) { c = c.replace(a, b); d = c.indexOf(a) } return c }; a(function () { a.each(a("form[data-ajax]"), function () { var b = a(this); if (b.data("ajax")) { b.ajaxForm({ onBefore: function () { if (window[b.data("ajax-before")]) { window[b.data("ajax-before")]() } }, onComplete: function () { if (window[b.data("ajax-complete")]) { window[b.data("ajax-complete")]() } }, onSuccess: function (a, c) { if (window[b.data("ajax-success")]) { window[b.data("ajax-success")](a, c) } } }) } }) }) })(jQuery)